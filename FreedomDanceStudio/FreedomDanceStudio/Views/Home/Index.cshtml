@{
    ViewData["Title"] = "Главная страница";
}

<!-- Главный экран -->
<section class="hero-section py-5 text-center">
    <div class="container">
        <h1 class="display-4 mb-3">Добро пожаловать в АИС FREEDOM!</h1>
        <p class="lead mb-4">Система учёта абонементов танцевальной студии</p>

    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card bg-primary text-white shadow">
                <div class="card-body">
                    <h3 class="card-title">Быстрый старт</h3>
                    <p class="card-text">Начните работу с системой прямо сейчас!</p>
                    <a asp-controller="AbonnementSales" asp-action="Create" class="btn btn-light btn-lg">
                        Создать продажу абонемента
                    </a>
                </div>
            </div>
        </div>
    </div>
    </div>
</section>

<!-- Статистика или важные уведомления -->
<section class="container py-4">
    <div class="row">
        <!-- Карточка «Клиенты» -->
        <div class="col-md-4 mb-3">
            <a asp-controller="Clients" asp-action="Index" class="card-link">
                <div class="card text-center h-100">
                    <div class="card-body">
                        <h4 class="card-title">Клиенты</h4>
                        <p class="card-text">Управляйте клиентской базой и историей посещений</p>
                    </div>
                </div>
            </a>
        </div>

        <!-- Карточка «Абонементы» -->
        <div class="col-md-4 mb-3">
            <a asp-controller="AbonnementSales" asp-action="Index" class="card-link">
                <div class="card text-center h-100">
                    <div class="card-body">
                        <h4 class="card-title">Абонементы</h4>
                        <p class="card-text">Создавайте и отслеживайте продажи абонементов</p>
                    </div>
                </div>
            </a>
        </div>

        <!-- Карточка «Услуги» -->
        <div class="col-md-4 mb-3">
            <a asp-controller="Services" asp-action="Index" class="card-link">
                <div class="card text-center h-100">
                    <div class="card-body">
                        <h4 class="card-title">Услуги</h4>
                        <p class="card-text">Настраивайте типы абонементов и их параметры</p>
                    </div>
                </div>
            </a>
        </div>
    </div>
</section>

<!-- Блок: Ближайшие окончания абонементов -->
<section class="container py-4">
    <h3 class="mb-3">Ближайшие окончания абонементов</h3>
    <div class="row" id="expiryAlertsContainer">
        @if (ViewBag.ExpiryAlerts != null && ViewBag.ExpiryAlerts.Count > 0)
        {
            @foreach (var alert in ViewBag.ExpiryAlerts)
            {
                <div class="col-md-6 col-lg-4 mb-3">
                    <div class="card alert-card @(alert.AlertLevel.ToLower())">
                        <div class="card-body">
                            <h5 class="card-title">@alert.Client?.FirstName @alert.Client?.LastName</h5>
                            <p class="card-text">
                                Абонемент истекает: <strong>@alert.ExpiryDate.ToString("dd.MM.yyyy")</strong>
                            </p>
                            <!-- Круговой индикатор -->
                            <div class="circular-progress" data-percent="@(100 - (alert.DaysRemaining * 100 / 30))">
                                <svg viewBox="0 0 36 36" class="circular-chart">
                                    <path class="circle-bg"
                                          d="M18 2.0845
                 a 15.9155 15.9155 0 0 1 0 31.831
                 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                    <path class="circle"
                                          stroke-dasharray="@(alert.DaysRemaining * 2 * Math.PI * 15.9155 / 30), 100"
                                          d="M18 2.0845
                 a 15.9155 15.9155 0 0 1 0 31.831
                 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                </svg>
                                <div class="percentage">
                                    @((100 - (alert.DaysRemaining * 100 / 30)).ToString("0"))%
                                </div>
                            </div>

                            <div class="mt-2">
                                <small class="text-muted">
                                    Осталось дней: <strong>@alert.DaysRemaining</strong>
                                </small>
                            </div>

                            <!-- Кнопка быстрого действия -->
                            <a asp-controller="AbonnementSales" asp-action="Edit" asp-route-id="@alert.AbonnementSaleId"
                               class="btn btn-sm btn-outline-primary mt-2 w-100">
                                Продлить абонемент
                            </a>
                        </div>
                    </div>
                </div>
            }
        }
        else
        {
            <div class="col-12">
                <div class="alert alert-info text-center">
                    Нет абонементов, заканчивающихся в ближайшие 30 дней.
                </div>
            </div>
        }
    </div>
</section>

@section Styles {
    <link rel="stylesheet" href="~/css/site.css" />
}

@section Scripts {
    <script src="~/js/home-expiry-alerts.js"></script>
}
