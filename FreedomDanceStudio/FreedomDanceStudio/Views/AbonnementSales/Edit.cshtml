@model AbonnementSale
@{
    ViewData["Title"] = "Редактирование продажи абонемента";
}

<div class="container mt-4">
    <h2>@ViewData["Title"]</h2>

    <form method="post">
        <input type="hidden" asp-for="Id" />

        <div class="row">
            <div class="col-md-6">
                <!-- Поле выбора клиента -->
                <div class="mb-3">
                    <label asp-for="ClientId" class="form-label">Клиент</label>
                    <select asp-for="ClientId" asp-items="ViewBag.Clients"
                            class="form-select" required>
                        <option value="">-- Выберите клиента --</option>
                    </select>
                    <span asp-validation-for="ClientId" class="text-danger"></span>
                </div>

                <!-- Поле выбора услуги -->
                <div class="mb-3">
                    <label asp-for="ServiceId" class="form-label">Тип абонемента</label>
                    <select asp-for="ServiceId" asp-items="ViewBag.Services"
                            class="form-select" required id="ServiceSelect">
                        <option value="">-- Выберите услугу --</option>
                    </select>
                    <span asp-validation-for="ServiceId" class="text-danger"></span>
                </div>

                <!-- Дата продажи (только для чтения) -->
                <div class="mb-3">
                    <label asp-for="SaleDate" class="form-label">Дата продажи</label>
                    <input asp-for="SaleDate" type="date" class="form-control"
                           asp-format="{0:yyyy-MM-dd}"
                           value="@Model.SaleDate.ToString("yyyy-MM-dd")" readonly/>
                    <span asp-validation-for="SaleDate" class="text-danger"></span>
                </div>

                <!-- Блок с информацией о выбранной услуге -->
                <div id="ServiceInfo" class="alert alert-info mb-3" style="display:none;">
                    <strong>Выбрана услуга:</strong> <span id="ServiceNameDisplay"></span><br>
                    <strong>Цена:</strong> <span id="PriceDisplay"></span> ₽<br>
                    <strong>Срок действия:</strong> <span id="DurationDisplay"></span> дней
                </div>

                <!-- Начало действия (только для чтения, сохраняется исходное значение) -->
                <div class="mb-3">
                    <label class="form-label">Начало действия</label>
                    <input type="text" class="form-control" readonly
                           value="@Model.StartDate.ToString("dd.MM.yyyy")"/>
                    <!-- Скрытое поле для передачи StartDate в контроллер -->
                    <input asp-for="StartDate" type="hidden"
                           value="@Model.StartDate.ToString("yyyy-MM-dd")"/>
                </div>

                <!-- Окончание действия (редактируемое) -->
                <div class="mb-3">
                    <label class="form-label">Окончание действия</label>
                    <!-- Видимое поле для редактирования -->
                    <input type="date" class="form-control"
                           id="EndDateDisplay"
                           value="@Model.EndDate.ToString("yyyy-MM-dd")"/>
                    <!-- Скрытое поле для передачи в контроллер -->
                    <input asp-for="EndDate" type="hidden" id="EndDateHidden"
                           value="@Model.EndDate.ToString("yyyy-MM-dd")"/>
                    <small class="text-muted">Можно изменить вручную или автоматически при смене услуги</small>
                    <span asp-validation-for="EndDate" class="text-danger"></span>
                </div>

                <button type="submit" class="btn btn-primary">Сохранить изменения</button>
                <a asp-action="Index" class="btn btn-secondary">Отмена</a>
            </div>
        </div>
    </form>
</div>


@section Scripts {
    <!-- Подключаем отдельные JS‑файлы -->
    <script src="~/js/edit_abonementSale/toast-notifications.js"></script>
    <script src="~/js/edit_abonementSale/form-validation.js"></script>
    <script src="~/js/edit_abonementSale/service-selection.js"></script>
    <script src="~/js/edit_abonementSale/edit-page-init.js"></script>
}
